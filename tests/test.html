<!DOCTYPE html>
<!--
    $ npm run build:esm
    $ npx http-server --port=8080
    $ open http://127.0.0.1:8080/tests/test.html
-->
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proform test</title>
    
    <!-- https://css-tricks.com/no-class-css-frameworks -->
    <!-- <link rel="stylesheet" href="https://cdn.rawgit.com/kimeiga/bahunya/css/bahunya-0.1.3.css"/> -->
    <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura-dark.css" type="text/css">
    
    <style>
        body {
            max-width: unset;
            
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-weight: 400;
            
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }
        
        pre {
            position: fixed;
            top: 0;
            left: 0;
            margin: 1.5rem;
            width: 50rem;
            min-height: 40rem;
            font-family: Menlo, Monaco, monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            line-break: anywhere;
        }
        
        form, .form {
            max-width: 100rem;
            margin-left: 30rem;
            padding: 2rem 0;
            
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        form:empty {
            display: none !important;
        }
        
        .validation-message {
            --line-height: 1.6em;
            
            margin: 0.2em 0.4em;
            
            /* FIXME: https://css-tricks.com/how-to-tame-line-height-in-css/ */
            min-height: calc(var(--line-height) + 1px); /* Hack correction for line-height/height discrepancy */
            
            line-height: var(--line-height);
            font-size: 1.2rem;
            font-weight: 400;
            color: indianred;
            
            overflow: hidden;
            opacity: 1;
            transform: translate(0, 0);
            transition: opacity 100ms ease-in 100ms, transform 100ms ease-in 100ms;
        }
        .validation-message:empty, .validation-message:not(.validation-message--visible) {
            pointer-events: none;
            display: block;
            opacity: 0;
            height: var(--line-height);
            transform: translate(0, calc(-0.1 * var(--line-height)));
        }
        
        input[type], select {
            margin: 0 !important;
            padding: 0.8rem 1.4rem;
            padding-top: 1.6rem;
            
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-weight: 400;
            font-size: 0.9em;
        }
        
        label.field {
            display: flex;
            flex-direction: column;
        }
        
        /* Floating label */
        label.field > .input-text > .label {
            pointer-events: none;
            align-self: center;
            
            position: absolute;
            left: 1.4rem; /* Should match input `padding-left` */
            
            opacity: 0.4;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-weight: 400;
            font-size: 0.9em;
            
            transition-property: transform, opacity, font-size;
            transition-duration: 100ms;
            transition-timing-function: ease-in;
            transition-delay: 100ms;
        }
        label.field > .input-text:focus-within > .label,
        label.field > .input-text:not(.input-text--empty) > .label {
            opacity: 0.6;
            font-size: 0.6em;
            transform: translate(0, -1em);
        }
        label.field > .input-text > input[type]::placeholder {
            transition: color 100ms ease-in 100ms;
        }
        label.field > .input-text.input-text--empty:not(:focus-within) > input[type]::placeholder {
            color: transparent;
        }
        
        label.field > .input-text {
            position: relative;
            display: flex;
            align-items: stretch;
        }
        
        label.field :is(.input-text input[type], select) {
            flex: 1;
            transition: border-color 100ms ease-in 100ms;
        }
        
        label.field > .input-text::after {
            content: '';
            pointer-events: none;
            
            align-self: center;
            position: absolute;
            /*top: 9px;*/
            right: 6px;
            line-height: 100%;
            
            font-family: monospace;
            font-size: 1.4em;
            
            opacity: 0;
            transition: opacity 100ms ease-in 100ms;
        }
        label.field--valid > .input-text::after { content: '✓'; color: #4caf50; }
        label.field--invalid > .input-text::after { content: '✕'; color: indianred; }
        label:focus-within > .input-text::after { opacity: 0.6; }
        
        label.field--valid > .input-text input:not(:focus) { border-color: #4caf50; }
        label.field--invalid > .input-text input:not(:focus) { border-color: indianred; }
    </style>
</head>
<body>
    <script type="importmap">
        {
            "imports": {
                "message-tag": "https://cdn.skypack.dev/message-tag",
                "react": "https://cdn.skypack.dev/react",
                "optics-ts": "https://cdn.skypack.dev/optics-ts",
                "classnames/dedupe": "https://cdn.skypack.dev/classnames/dedupe"
            }
        }
    </script>
    <script type="module">
        import htm from 'https://cdn.skypack.dev/htm';
        import React from 'https://cdn.skypack.dev/react';
        import ReactDOM from 'https://cdn.skypack.dev/react-dom';
        import * as Proform from '../lib-esm/proform.js';
        import { test } from '../lib-esm/index.js';
        
        const html = htm.bind(React.createElement);
        
        const { TestApp } = test();
        
        /*
        const Form = Proform.makeForm();
        
        const App = () => {
            const [buffer, setBuffer] = React.useState({ name: '' });
            return html`
                <${Form.FormProvider}
                    buffer=${buffer}
                    updateBuffer=${setBuffer}
                >
                    <${Form.InputText}
                        accessor=${buffer => buffer.name}
                        update=${(buffer, name) => ({ ...buffer, name })}
                    />
                <//>
            `;
        };
        */
        
        window.addEventListener('DOMContentLoaded', () => {
            // ReactDOM.render(html`<${App}/>`, document.body);
            ReactDOM.render(html`<${TestApp}/>`, document.body);
        });
    </script>
</body>
</html>
